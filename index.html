<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒŸ Ruru é™ªç©å¯¶è²å–® ğŸŒŸ</title>
  <style>
    body { background-image: url('star-bg-demo.jpg'); background-size: cover; background-attachment: fixed; font-family: 'Microsoft JhengHei', Arial, sans-serif; color: #333; margin: 0; padding: 0; }
    .container { background: rgba(255,255,255,0.97); max-width: 820px; margin: 40px auto 22px auto; padding: 32px 18px 18px 18px; border-radius: 28px; box-shadow: 0 0 28px #fae89d; position: relative; }
    .title-header { text-align:center; margin-bottom:22px; position:relative; }
    .minions-row { display:flex; justify-content:center; gap:26px; margin-bottom:10px; }
    .minions-row.bottom { margin-top:15px; margin-bottom:0; }
    .minions-row img { width:88px; height:88px; }
    .title-row { display: flex; align-items: center; justify-content: center; gap: 38px; margin-bottom: 0; }
    .q-ruru-inline { width: 152px; border-radius: 20px; box-shadow: 0 0 10px #ffe082b0; background: #fff; }
    h1 { flex: 0 1 auto; color: #ffb300; margin: 0 0 0 0; font-size: 2.5em; letter-spacing: 2px; text-align: center; font-weight: bold; text-shadow: 0 2px 8px #fff9cd; }
    .form-section { margin-bottom:22px; }
    label { font-weight: bold; margin-top: 18px; display: block; color: #333; font-size: 1.11em;}
    input[type="text"], input[type="number"], select { width: 95%; padding: 10px; border: 1.9px solid #ffde89; border-radius: 10px; margin-bottom: 8px; margin-top: 4px; font-size: 1.09em; box-sizing: border-box;}
    input[type="file"] { margin: 8px 0 16px 0;}
    .checkbox-label { font-weight: normal; margin-left: 4px;}
    .order-summary { background: #fff7e0; padding: 20px; border-radius: 18px; margin: 27px 0 15px 0; font-size: 1.15em; box-shadow: 0 0 12px #ffe08265;}
    .footer { margin-top: 22px; text-align: center; color: #666; font-size: 1.07em; }
    .qr { display:block; margin:22px auto 7px auto; width:105px; border-radius:16px; box-shadow:0 0 9px #ffef8f55;}
    button, .btn { background: #ffd43b; color:#a67200; font-size: 1.22em; border:none; border-radius:12px; padding:13px 32px; cursor:pointer; margin-top:13px; box-shadow:0 2px 12px #ffe08270; transition:0.1s; font-weight:bold; }
    button:hover { background: #fff176; color: #e67a00;}
    .agree-label { font-weight: normal; color:#c18700; }
    .notice {background:#fffbe0; color:#b8860b; border-radius:10px; border:1px solid #ffe082; padding:9px 13px; margin-bottom:14px; font-size:1em;}
    .disabled { color: #aaa !important;}
    .query-btn { background: #e8f5e8; color: #2e7d32; font-size: 1.1em; border: none; border-radius: 8px; padding: 8px 16px; cursor: pointer; margin: 5px; transition: 0.2s; }
    .query-btn:hover { background: #c8e6c8; }
    .query-btn.orange { background: #fff3e0; color: #ef6c00; }
    .query-btn.orange:hover { background: #ffe0b2; }
    .vip-section { background: #f3e5f5; border: 1px solid #e1bee7; border-radius: 8px; padding: 12px; margin-top: 10px; }
    @media (max-width: 800px) {
      .container { max-width: 99vw; padding: 3vw 1.5vw;}
      .q-ruru-inline { width:90px;}
      .minions-row img { width:50px; height:50px;}
      .qr { width:54px; }
      h1 { font-size: 1.35em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ==== æ¨™é¡Œ+é ­è²¼+ä¸Šä¸‰ä¸‹ä¸‰å°å°å…µ ==== -->
    <div class="title-header">
      <div class="minions-row">
        <img src="minion-1.png" alt="å°å°å…µ1">
        <img src="minion-2.png" alt="å°å°å…µ2">
        <img src="minion-3.png" alt="å°å°å…µ3">
      </div>
      <div class="title-row">
        <h1>ğŸŒŸ Ruru é™ªç©å¯¶è²å–® ğŸŒŸ</h1>
        <img src="q-ruru-demo.png" class="q-ruru-inline" alt="Qç‰ˆRuru">
      </div>
      <div class="minions-row bottom">
        <img src="minion-4.png" alt="å°å°å…µ4">
        <img src="minion-5.png" alt="å°å°å…µ5">
        <img src="minion-6.png" alt="å°å°å…µ6">
      </div>
    </div>
    <form id="orderForm" autocomplete="off">
      <div class="form-section">
        <label for="contactMethod">è¯çµ¡æ–¹å¼ï¼ˆå¿…é¸ï¼‰</label>
        <select id="contactMethod" required onchange="showContactInput()">
          <option value="">è«‹é¸æ“‡è¯çµ¡æ–¹å¼</option>
          <option value="discord">Discord</option>
          <option value="instagram">Instagram</option>
          <option value="line">LINE</option>
        </select>
      </div>
      <div class="form-section" id="contactInputSection" style="display:none;">
        <label for="contactId" id="contactLabel">è¯çµ¡ IDï¼ˆå¿…å¡«ï¼‰</label>
        <input type="text" id="contactId" maxlength="30" required placeholder="è«‹å¡«å¯«æ‚¨çš„ ID">
      </div>
      <div class="form-section">
        <label>é™ªç©é …ç›®ï¼ˆå¯è¤‡é¸ï¼‹å¡«å–®æ•¸ï¼‰</label>
        <div>
          <input type="number" id="s1" min="0" max="99" value="0" style="width:64px;"> <span class="checkbox-label">å‚³èªªå°æ±ºï¼ˆ$200/å…©å ´ï¼‰</span><br>
          <input type="number" id="s2" min="0" max="99" value="0" style="width:64px;"> <span class="checkbox-label">èªéŸ³é€šè©±ï¼ˆ$250/30åˆ†ï¼‰</span><br>
          <input type="number" id="s3" min="0" max="99" value="0" style="width:64px;"> <span class="checkbox-label">æ‰“å­—èŠå¤©ï¼ˆ$200/30åˆ†ï¼‰</span><br>
          <input type="number" id="s4" min="0" max="99" value="0" style="width:64px;"> <span class="checkbox-label">å…¨æ°‘Party å”±æ­Œï¼ˆ$100/é¦–ï¼‰</span><br>
          <input type="number" id="s5" min="0" max="99" value="0" style="width:64px;"> <span class="checkbox-label">æƒ…æ„Ÿè«®è©¢ï¼ˆ$200/30åˆ†ï¼‰</span><br>
        </div>
      </div>
      <!-- ğŸ”¥ é ç´„æ™‚é–“ï¼ˆå‹•æ…‹åˆ¤æ–·æ˜ŸæœŸã€å·²é ç´„ï¼‰ğŸ”¥ -->
      <div class="form-section">
        <label>é ç´„æ™‚é–“ï¼ˆå·²é ç´„ï¼å·²éæ™‚æ®µæœƒé¡¯ç¤ºä¸å¯é¸ï¼‰</label>
        <select id="weekday" required>
          <option value="">è«‹é¸æ“‡æ˜ŸæœŸ</option>
          <option value="1">æ˜ŸæœŸä¸€</option>
          <option value="2">æ˜ŸæœŸäºŒ</option>
          <option value="3">æ˜ŸæœŸä¸‰</option>
          <option value="4">æ˜ŸæœŸå››</option>
          <option value="5">æ˜ŸæœŸäº”</option>
          <option value="6">æ˜ŸæœŸå…­</option>
          <option value="7">æ˜ŸæœŸæ—¥</option>
        </select>
        <select id="timeblock" required>
          <option value="">è«‹é¸æ“‡æ™‚æ®µ</option>
        </select>
        <div id="timeNotice" class="notice" style="display:none;"></div>
      </div>
      <!-- è¦å‰‡å‹¾é¸ -->
      <div class="form-section" style="margin-bottom: 8px;">
        <div style="max-height:210px; overflow-y:auto; border:1.2px solid #ffe082; background:#fffdf5; border-radius:9px; padding:10px; font-size:1em; color:#a36b00;">
          <b>ã€ŠRu çš„é™ªç©æ³¨æ„äº‹é …èˆ‡æœå‹™è¦å‰‡ã€‹ğŸŒ¹</b><br>
          ğŸ“Œ ä¸‹å–®å‰è«‹å‹™å¿…è©³é–±ï¼Œä¿éšœå½¼æ­¤æ¬Šç›Šèˆ‡äº’å‹•å“è³ªã€‚<br>
          <b>ğŸ§¡ ä¸€ã€æœå‹™æœ¬è³ªèˆ‡äº’å‹•åŸå‰‡</b><br>
          æœ¬æœå‹™ç‚ºç´”ç·šä¸Šã€ŒèªéŸ³ï¼æ–‡å­—èŠå¤©ã€é™ªå”±ã€é™ªç©éŠæˆ²ã€ç­‰é™ªä¼´äº’å‹•â€¦<br>
          <b>ğŸ’³ äºŒã€ä»˜æ¬¾èˆ‡é ç´„é ˆçŸ¥</b><br>
          é ˆå…ˆå®Œæˆä»˜æ¬¾ï¼ˆLine Payï¼åŒ¯æ¬¾ï¼‰â€¦<br>
          <b>ğŸ•’ ä¸‰ã€æ’ç¨‹èˆ‡æ™‚é–“èªªæ˜</b><br>
          è‹¥åŒæ™‚æ®µé ç´„äººæ•¸å¤šâ€¦<br>
          <b>ğŸ›¡ï¸ å››ã€ç¦æ­¢è¡Œç‚ºèˆ‡é»‘å–®åˆ¶åº¦</b><br>
          åš´ç¦ä»¥ä¸‹é•è¦è¡Œç‚ºâ€¦<br>
          <b>ğŸ“¢ äº”ã€ç¤¾ç¾¤èˆ‡ IG è¦ç¯„</b><br>
          æ­¡è¿è¿½è¹¤ IGï¼š@fangru_0731â€¦<br>
          <b>ğŸ” å…­ã€éš±ç§ä¿è­·èˆ‡å…¬é–‹é™åˆ¶</b><br>
          æ‰€æœ‰èªéŸ³ã€æ–‡å­—ã€åœ–ç‰‡å…§å®¹çš†å±¬ç§äººäº’å‹•â€¦<br>
          <b>ğŸš« ä¸ƒã€å„ªæƒ èˆ‡é»‘åå–®è¦å‰‡</b><br>
          å„ªæƒ åˆ¸èˆ‡æ´»å‹•ä¸å¾—é‡è¤‡ä½¿ç”¨â€¦<br>
          <b>ğŸŒ¸ å…«ã€æº«æŸ”çµèª</b><br>
          æˆ‘æ˜¯ Ruï¼Œè‡´åŠ›æ–¼æ‰“é€ ä¸€å€‹æº«æŸ”ã€å®‰å…¨ã€ç•Œç·šæ¸…æ¥šçš„é™ªä¼´ç©ºé–“â€¦<br>
          <br>
          <b style="color:#c22;">ğŸ“Œ âŸªä¸‹å–®å³è¡¨ç¤ºæ‚¨å·²é–±è®€ä¸¦å®Œå…¨åŒæ„ä¸Šè¿°æ‰€æœ‰æœå‹™æ¢æ¬¾ï¼Œé•åè¦å‰‡æ•ä¸é€€æ¬¾ä¹Ÿä¸å†æä¾›æœå‹™âŸ«</b>
        </div>
        <label class="agree-label"><input type="checkbox" id="agreeRule" required> æˆ‘å·²è©³ç´°é–±è®€ä¸¦åŒæ„ä¸Šè¿°ã€ŠRu çš„é™ªç©æ³¨æ„äº‹é …èˆ‡æœå‹™è¦å‰‡ã€‹ï¼ˆå¿…é ˆå‹¾é¸ï¼‰</label>
      </div>
      <div class="form-section" style="text-align:center;">
        <button type="submit" class="btn">å®Œæˆé ç´„ä¸¦é€å‡º</button>
      </div>
    </form>

    <!-- è¨‚å–®ç¸½è¦½ -->
    <div class="order-summary" id="summaryBox">
      <b>é ç´„æ™‚é–“ï¼š</b><span id="showTime"></span><br>
      <b>æ‰€é¸é …ç›®ï¼š</b><span id="showItems"></span><br>
      <b>æœå‹™é‡‘é¡å°è¨ˆï¼š</b><span id="subtotalTxt">0</span> å…ƒ<br>
      <b>æœ€çµ‚æ‡‰ä»˜é‡‘é¡ï¼š</b><span id="total">0</span> å…ƒ
    </div>
    <!-- LINE QR code -->
    <img src="ru-line-qr-demo.png" class="qr" alt="Line QR Code">
    <div class="footer">åŠ æˆ‘å®˜æ–¹ LINE è¯ç¹«å–”ï¼</div>
  </div>
  <!-- JS åŠŸèƒ½å€ -->
  <script>
  // é€±æ™‚æ®µè¨­å®š
const weekSlots = {
  "1": ["19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"],
  "2": ["00:00","00:30","01:00","01:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"],
  "3": ["23:00","23:30","00:00","00:30","01:00","01:30"],
  "4": ["19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30","00:00","00:30"],
  "5": ["23:00","23:30","00:00","00:30"],
  "6": ["19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30","00:00","00:30","01:00","01:30"],
  "7": [
    "00:00","00:30","01:00","01:30","02:00","02:30","03:00","03:30",
    "04:00","04:30","05:00","05:30","06:00","06:30","07:00","07:30","08:00","08:30","09:00","09:30",
    "10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30",
    "16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"
  ]
};

function pad0(n){ return n<10?"0"+n:n;}
function getToday(){
  let d = new Date();
  let wd = d.getDay();
  return wd===0?7:wd;
}

function updateTimeblocks() {
  const day = document.getElementById('weekday').value;
  const blockSel = document.getElementById('timeblock');
  blockSel.innerHTML = '<option value="">è«‹é¸æ“‡æ™‚é–“</option>';
  if (!weekSlots[day]) return;
  let today = getToday();
  let nowHM = pad0(new Date().getHours())+":"+pad0(new Date().getMinutes());
  weekSlots[day].forEach(time => {
    let disabled = false;
    if (Number(day)<today) disabled = true;
    if (Number(day)===today && time<=nowHM) disabled = true;
    let opt = document.createElement('option');
    opt.value = time;
    opt.innerText = (disabled?"[å·²è¢«é ç´„/å·²é] ":"")+time;
    if (disabled) opt.disabled = true;
    blockSel.appendChild(opt);
  });
  document.getElementById("timeNotice").style.display="block";
  document.getElementById("timeNotice").innerHTML="* æ™‚é–“è‹¥é¡¯ç¤º[å·²è¢«é ç´„/å·²é]å‰‡ç„¡æ³•é¸ï¼Œè«‹æ”¹é¸å…¶ä»–æ™‚æ®µï¼";
}
    // é¡¯ç¤ºè¯çµ¡æ–¹å¼è¼¸å…¥æ¬„ä½
    function showContactInput() {
      const contactMethod = document.getElementById('contactMethod').value;
      const contactInputSection = document.getElementById('contactInputSection');
      const contactLabel = document.getElementById('contactLabel');
      const contactId = document.getElementById('contactId');
      
      if (contactMethod) {
        contactInputSection.style.display = 'block';
        contactId.required = true;
        
        switch (contactMethod) {
          case 'discord':
            contactLabel.textContent = 'Discord IDï¼ˆå¿…å¡«ï¼‰';
            contactId.placeholder = 'è«‹å¡«å¯«æ‚¨çš„ Discord IDï¼Œä¾‹å¦‚ï¼šusername#1234';
            break;
          case 'instagram':
            contactLabel.textContent = 'Instagram IDï¼ˆå¿…å¡«ï¼‰';
            contactId.placeholder = 'è«‹å¡«å¯«æ‚¨çš„ Instagram IDï¼Œä¾‹å¦‚ï¼š@username';
            break;
          case 'line':
            contactLabel.textContent = 'LINE IDï¼ˆå¿…å¡«ï¼‰';
            contactId.placeholder = 'è«‹å¡«å¯«æ‚¨çš„ LINE IDï¼Œä¾‹å¦‚ï¼š@username';
            break;
        }
      } else {
        contactInputSection.style.display = 'none';
        contactId.required = false;
      }
    }
    
    function calcAll() {
      let price = [200,250,200,100,200];
      let items = [];
      let subtotal = 0;
      let singles = 0;
      for(let i=1;i<=5;i++){
        let v = parseInt(document.getElementById('s'+i).value)||0;
        if(v>0){
          items.push(['å‚³èªªå°æ±º','èªéŸ³é€šè©±','æ‰“å­—èŠå¤©','å…¨æ°‘Party å”±æ­Œ','æƒ…æ„Ÿè«®è©¢'][i-1]+' x'+v);
          subtotal += v*price[i-1];
          singles += v;
        }
      }
      document.getElementById('showItems').innerText = items.join('ã€')||'ç„¡';
      document.getElementById('subtotalTxt').innerText = subtotal;
      document.getElementById('total').innerText = subtotal;
      document.getElementById('showTime').innerText =
        (document.getElementById('weekday').options[document.getElementById('weekday').selectedIndex].text || '') +
        (document.getElementById('timeblock').value ? ' ' + document.getElementById('timeblock').value : '');
    }
  // ====== è¡¨å–®é€å‡º ======
document.getElementById("orderForm").onsubmit = function(event){
  event.preventDefault();
  if (!document.getElementById("agreeRule").checked) {
    alert("è«‹å‹¾é¸åŒæ„æœå‹™è¦å‰‡ï¼");
    return;
  }
  // æª¢æŸ¥è‡³å°‘æœ‰ä¸€å€‹é …ç›®æ•¸é‡æ˜¯ 1 æˆ–ä»¥ä¸Š
  let hasItems = false;
  for(let i=1; i<=5; i++){
    let v = parseInt(document.getElementById('s'+i).value)||0;
    if(v >= 1){
      hasItems = true;
      break;
    }
  }
  if(!hasItems){
    alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹é™ªç©é …ç›®ï¼ˆæ•¸é‡é ˆç‚º 1 æˆ–ä»¥ä¸Šï¼‰ï¼");
    return;
  }
  
  // åœ¨æäº¤å‰å…ˆè¨ˆç®—é‡‘é¡
  calcAll();
  let formData = {
    contactMethod: document.getElementById('contactMethod').value,
    contactId: document.getElementById('contactId').value,
    legendCount: parseInt(document.getElementById('s1').value) || 0,
    voiceCount: parseInt(document.getElementById('s2').value) || 0,
    chatCount: parseInt(document.getElementById('s3').value) || 0,
    partyCount: parseInt(document.getElementById('s4').value) || 0,
    consultCount: parseInt(document.getElementById('s5').value) || 0,
    weekday: document.getElementById('weekday').options[document.getElementById('weekday').selectedIndex].text || '',
    timeSlot: document.getElementById('timeblock').value,
    fullDateTime: (document.getElementById('weekday').options[document.getElementById('weekday').selectedIndex].text || '') + ' ' + (document.getElementById('timeblock').value || ''),
    selectedItems: document.getElementById('showItems').innerText,
    subtotal: parseInt(document.getElementById('subtotalTxt').innerText) || 0,
    total: parseInt(document.getElementById('total').innerText) || 0,
    remark: ''
  };
  fetch("https://script.google.com/macros/s/AKfycbzGhVqs1VhuxHx49frfjPug83DhbDE9JL1rBmz8ryHKkx4lx8Wm2bO0mP0x81_pa2jb/exec" + Date.now(), {
    method: "POST",
    body: JSON.stringify(formData),
    headers: { "Content-Type": "text/plain" },
    credentials: 'omit'
  }).then(r=>r.text()).then(res=>{
    if(res.indexOf("success")>=0){
      alert('é ç´„æˆåŠŸï¼');
      document.getElementById('orderForm').reset();
      calcAll();
    }else if(res.indexOf("é»‘åå–®")>=0){
      alert("ä½ å·²è¢«åŠ å…¥é»‘åå–®ï¼Œç„¡æ³•é ç´„ï¼");
    }else if(res.indexOf("æ­¤æ™‚æ®µå·²è¢«é ç´„")>=0){
      alert('æ­¤æ™‚æ®µå·²è¢«é ç´„ï¼Œè«‹é‡æ–°é¸æ“‡ï¼');
    }else{
      alert('é€å‡ºå¤±æ•—ï¼Œè«‹è¯çµ¡Ruï¼');
    }
  }).catch(e=>{
    alert('é€å‡ºå¤±æ•—ï¼Œè«‹è¯çµ¡Ruï¼');
  });
};

// ====== ç¶å®š change äº‹ä»¶ï¼ˆæ”¾æœ€ä¸‹é¢ï¼ï¼‰======
window.onload = function(){
  document.getElementById('weekday').addEventListener('change', updateTimeblocks);
  // é è¨­å¦‚æœé é¢ä¸€é–‹å§‹å°±æœ‰é¸æ˜ŸæœŸï¼Œä¹Ÿç›´æ¥è·‘ä¸€æ¬¡
  updateTimeblocks();
}
  </script>
</body>
</html>
